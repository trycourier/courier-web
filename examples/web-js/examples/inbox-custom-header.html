<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>web-js</title>
  <link rel="stylesheet" href="../styles.css">
</head>

<body>

  <courier-inbox id="inbox"></courier-inbox>

  <script type="module">
    import { Courier } from '@trycourier/courier-ui-inbox';

    // Reference the courier-inbox element
    const inbox = document.getElementById('inbox');

    // Remove the header
    inbox.removeHeader();

    // Set a custom header
    inbox.setHeader((props) => {
      const headerDiv = document.createElement('div');
      headerDiv.style.background = 'red';
      headerDiv.style.fontSize = '20px';
      headerDiv.style.color = 'white';
      headerDiv.style.padding = '20px';
      headerDiv.style.width = '100%';
      headerDiv.style.fontFamily = 'monospace';

      // Find selected feed and tab
      const selectedFeed = props.feeds.find(feed => feed.isSelected);
      const selectedTab = selectedFeed?.tabs.find(tab => tab.isSelected);

      // Prepare summary for header
      let feedPart = selectedFeed ? `${selectedFeed.feedId}` : 'No Feed Selected';
      let tabPart = selectedTab ? `${selectedTab.datasetId}` : 'No Tab Selected';
      let unreadPart = typeof selectedTab?.unreadCount === 'number' ? `Unread: ${selectedTab.unreadCount}` : '';

      headerDiv.textContent = `${feedPart} / ${tabPart} ${unreadPart && '- ' + unreadPart}`;

      return headerDiv;
    });

    // Set the feeds
    inbox.setFeeds([
      {
        feedId: 'inbox',
        title: 'Inbox',
        tabs: [
          { datasetId: 'inbox', title: 'Inbox', filter: {} }
        ]
      },
      {
        feedId: 'archive',
        title: 'Archive',
        tabs: [
          { datasetId: 'archive_1', title: 'Archive 1', filter: { archived: true } },
          { datasetId: 'archive_2', title: 'Archive 2', filter: { archived: true } }
        ]
      }
    ]);

    // Authenticate the user with the inbox
    Courier.shared.signIn({
      userId: import.meta.env.VITE_USER_ID,
      jwt: import.meta.env.VITE_JWT
    });

    // Select the feed and tab
    inbox.selectFeed('archive');
    inbox.selectTab('archive_2');

  </script>

</body>

</html>